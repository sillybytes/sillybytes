<!doctype html>
<html lang="en">
    <head>
        <title>Silly Bytes</title>

        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="../../css/default.css" />
        <link rel="stylesheet" href="../../css/post-list.css" />
        <link rel="stylesheet" href="../../css/post.css" />

        <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../bower_components/highlight/src/styles/solarized-light.css" />

        <script src="../../bower_components/jquery/dist/jquery.min.js"></script>
        <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../../bower_components/highlight/src/highlight.pack.js"></script>

        <script> hljs.initHighlightingOnLoad(); </script>

    </head>
    <body>
        <header class="container-fluid">
            <div class="row">
                <div class="col-xs-12">
                    <a href="../../">
                        <img alt="Silly Bytes" id="logo" class="image-responsive" src="../../img/newcog.png" />
                    </a>
                </div>
            </div>
        </header>

        <div id="blog" class="container-fluid">
            <div class="row">

                <div id="sidebar" class="hidden-xs hidden-sm col-md-3">
                    <div id="author">
                        <img id="author-pic" src="../../img/danie.jpg">
                        <h3 id="author-name">Daniel Campoverde [alx741]</h3>
                        <img id="location-icon" src="../../img/location_icon.png">
                        <span id="location">Cuenca, Ecuador</span>
                    </div>

                    <div id="findme">
                        <h2 class="sidebar-h2">FIND ME</h2>
                        <a target="_blank" href="https://github.com/alx741">
                            <img class="icon" src="../../img/github.png">
                        </a>
                        <a target="_blank" href="https://twitter.com/alx741alx">
                            <img class="icon" src="../../img/twitter.png">
                        </a>
                        <a target="_blank" href="https://www.facebook.com/sillybytes/">
                            <img class="icon" src="../../img/facebook.png">
                        </a>
                        <a target="_blank" href="https://plus.google.com/116038619580828681039">
                            <img class="icon" src="../../img/google.png">
                        </a>
                        <a target="_blank" href="https://www.joindiaspora.com/u/alx741">
                            <img class="icon" src="../../img/diaspora.png">
                        </a>

                        <div id="findme-textual">
                            <b>Freenode:</b> #vim, #archlinux, #avr, #rust, #haskell,
                            #yesod, #zsh, #sillybytes
                            <hr>
                            <b>Mailto:</b> alx@sillybytes.net
                            <br>
                            <b>GPG Key ID:</b> 12622B78
                            <hr>
                            <b>Chat</b> with me <a target="_blank" href="http://webchat.freenode.net/?channels=sillybytes">here</a>
                        </div>


                        <div id="facebook-embed" class="embed-responsive embed-responsive-16by9">
                            <iframe src="//www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2Fsillybytes&amp;width&amp;height=290&amp;colorscheme=light&amp;show_faces=true&amp;header=true&amp;stream=false&amp;show_border=true" scrolling="yes" style="border:none; overflow:hidden; height:290px;" allowtransparency="false" frameborder="0"></iframe>
                        </div>
                    </div>


                    <div id="dotfiles">
                        <h2 class="sidebar-h2">DOTFILES</h2>
                        <p>
                            Software configuration, scripts, tools and magic.
                            Be sure to add <b>attribution </b> when using them
                            (fully or partially).
                        </p>
                        <a target="_blank" href="https://github.com/alx741/dotfiles#readme">
                            <img id="dotfiles-img" src="../../img/dotfiles.png">
                        </a>
                    </div>

                    <div id="about">
                        <h2 class="sidebar-h2">ABOUT</h2>

                        <a target="_blank" href="http://www.haskellers.com/user/4249">
                            <img id="haskellers-img" class="badge" alt="I'm a Haskeller" src="../../img/haskellers.png">
                        </a>

                        <img id="fsf-img" class="badge" alt="Free Software Fundation Member" src="../../img/fsf.png">

                        <a target="_blank" href="http://internetdefenseleague.org/">
                            <img id="idl-img" class="badge" alt="Internet Defesen League" src="../../img/idl.png">
                        </a>
                    </div>


                    <div id="license">
                        <h2 class="sidebar-h2">LICENSE</h2>

                        <a target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
                            <img id="cc-img" alt="Creative Commons - SA - BY" src="../../img/cc.png">
                        </a>
                        <p id="cc-text">
                            Silly Bytes by Daniel Alejandro Campoverde Carrión
                            [alx741] is licensed under a
                            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
                                Creative Commons Attribution-ShareAlike 3.0 Unported License.
                            </a>
                        </p>
                    </div>


                </div>


                <div id="content" class="col-xs-12 col-md-9">
                    <div class="row">
    <div class="post col-xs-12">
        <h2 class="post-title">Controlando un auto Radio Control con la PC</h2>
        <div class="post-date-author">
            Posted on October 14, 2012
            
                by Daniel Campoverde
            
        </div>
        <div class="post-content">
            <p><img src="../../img/rccar/thumbnail.png" id="thumbnail" /><br />
Como todo buen geek, de pequeño me fascinaban los autos RC (radio control), no tanto por el entretenimiento que supone jugar con ellos si no por la fascinación de averiguar su funcionamiento y todo lo que se puede hacer desarmando uno para convertir su mecanismo en algo completamente distinto.</p>
<p>Así pues hoy he visto en mi repisa el ultimo que me quedaba sin desarmar y pensé que ya era hora de decidir cual sería su destino, lo que hice fue adaptarlo para poder controlarlo desde la PC usando las teclas de dirección del teclado (como si de un juego se tratase), nuevamente, con miras ha hacer con ello algo un poco más interesante.</p>
<p>Para empezar cabe aclarar que dentro de la gran variedad de diseños, formas y sabores de los autos RC yo he hecho esto adaptado al mio, pero resulta trivial hacerlo para el auto que tengas a la mano.</p>
<!--more-->
<h1 id="hardware">Hardware</h1>
<p>En la imagen pueden ver al auto y su control, el cual tomaremos y desarmaremos para sacar por completo su placa de circuito.</p>
<div class="figure">
<img src="../../img/rccar/shot1.jpg" class="img-responsive" />

</div>
<p>Para retirarlo sacaremos todos los tornillos y cortaremos los cables del conector de la batería (dejando estos en el circuito), el resultado es este:</p>
<div class="figure">
<img src="../../img/rccar/shot2.jpg" class="img-responsive" />

</div>
<p>Ahora podemos soldar alambres más cómodos para la protoboard en los cables de alimentación eliminando aquel interruptor.</p>
<p>Como se puede observar el funcionamiento de esta placa consiste en 4 interruptores metálicos que al empujarse cierran unos contactos, así que lo que hice fue soldar un cable en cada contacto como se aprecia en la imagen.</p>
<p><img src="../../img/rccar/shot3.jpg" class="img-responsive" /> <img src="../../img/rccar/shot4.jpg" class="img-responsive" /> <img src="../../img/rccar/shot5.jpg" class="img-responsive" /></p>
<p>Básicamente lo que haremos será tomar la señal emitida por el puerto paralelo de la PC para saturar un transistor, el cual “unirá” a través de estos cables los contactos del interruptor del control, que a su vez accionara el auto.</p>
<p>El esquema de conexión es el siguiente:</p>
<div class="figure">
<img src="../../img/rccar/scheme1.png" class="img-responsive" />

</div>
<p>El montaje en la protoboard luce así:</p>
<p><img src="../../img/rccar/shot6.jpg" class="img-responsive" /> <img src="../../img/rccar/shot7.jpg" class="img-responsive" /></p>
<p>La alimentación la he tomado también del puerto paralelo como se puede ver, pero lo ideal sería usar una batería de 9V separada, para potenciar mejor la placa y tener un mayor alcance, para hacer esto debemos dejar conectado el cable a masa (PIN 25 del puerto) y retirar simplemente la conexión del PIN 1 para conectar la batería (tanto positivo como negativo).</p>
<p>Aquí se ve como conecté en el puerto paralelo (usé el cable de una vieja impresora para facilitarme el puerto hasta la mesa, pero se puede hacer directamente en el puerto del mainboard):</p>
<div class="figure">
<img src="../../img/rccar/shot8.jpg" class="img-responsive" />

</div>
<h1 id="software">Software</h1>
<p>Mi auto RC funciona accionando cada par de ruedas laterales de forma independiente, es decir: para cada movimiento es necesario accionar simultáneamente 2 interruptores en la combinación adecuada. Para dar marcha hacia adelante o atrás hay que accionar simultáneamente 2 interruptores del control, para girar se accionan 2 interruptores opuestos, de forma que un par de ruedas giren en un sentido y el otro par de ruedas en el sentido opuesto haciendo así girar el auto.</p>
<p>El software que escribí hace trabajar a mi auto como se puede observar, más si se quiere usar un auto cuya dirección es distinta se debe adaptar el código.</p>
<p>Además el software está escrito para sistemas <em>Unix, yo específicamente he usado una distribución GNU/Linux. Recuerda asegurarte de tener instalada la librería </em>ncurses* en tu sistema.</p>
<p><a href="https://github.com/alx741/rc_car_pc_control">Código en Github</a></p>
<div class="sourceCode"><pre class="sourceCode c"><code class="sourceCode c"><span class="co">/*</span>
<span class="co"> * ============================================================================</span>
<span class="co"> *</span>
<span class="co"> *       Filename:  rc.cpp</span>
<span class="co"> *</span>
<span class="co"> *    Description:  Código para controlar auto RC por puerto paralelo</span>
<span class="co"> *</span>
<span class="co"> *        Version:  1.0</span>
<span class="co"> *        Created:  12/10/12 20:23:28</span>
<span class="co"> *       Revision:  none</span>
<span class="co"> *       Compiler:  g++</span>
<span class="co"> *</span>
<span class="co"> *         Author:  Daniel Campoverde Carrión [Alx741]</span>
<span class="co"> *   Organization:  www.silly-bytes.blogspot.com</span>
<span class="co"> *</span>
<span class="co"> * ===========================================================================</span>
<span class="co"> */</span>


<span class="pp">#include </span><span class="im">&lt;iostream&gt;</span>
<span class="pp">#include </span><span class="im">&lt;ncurses.h&gt;</span>
<span class="pp">#include </span><span class="im">&lt;sys/io.h&gt;</span>

<span class="pp">#define puerto (0x378) </span><span class="co">//Puede ser (0x278)</span>


using namespace std;

<span class="dt">int</span> main(<span class="dt">void</span>){

<span class="co">//inicializamos ncurses</span>
initscr();
cbreak();
noecho();
nonl();
intrflush(stdscr, FALSE);
keypad(stdscr, TRUE);


<span class="co">//Abrir puerto y configurar permisos</span>
<span class="cf">if</span>(ioperm(puerto,<span class="dv">1</span>,<span class="dv">1</span>)){
	cout &lt;&lt; <span class="st">&quot;Error de permisos&quot;</span> &lt;&lt; endl &lt;&lt; flush;
    }


    <span class="dt">int</span> ch;

    <span class="co">//recibimos las pulsaciones</span>
    <span class="co">//bit1,bit3 -&gt; adelante</span>
    <span class="co">//bit2,bit4 -&gt; atras</span>
    <span class="co">//bit3,bit2 -&gt; derecha</span>
    <span class="co">//bit4,bit1 -&gt; izquierda</span>
    <span class="cf">while</span>(true){

		ch=getch();
		<span class="cf">if</span>(ch==<span class="dv">32</span>) outb(<span class="dv">0</span>,puerto);
		<span class="cf">if</span>(ch==<span class="dv">259</span>) outb(<span class="dv">5</span>,puerto); <span class="co">//ascii 259=(arriba)</span>
		<span class="cf">if</span>(ch==<span class="dv">258</span>) outb(<span class="dv">10</span>,puerto); <span class="co">//ascii 258=(abajo)</span>
		<span class="cf">if</span>(ch==<span class="dv">261</span>) outb(<span class="dv">6</span>,puerto); <span class="co">//ascii 261=(derecha)</span>
		<span class="cf">if</span>(ch==<span class="dv">260</span>) outb(<span class="dv">9</span>,puerto); <span class="co">//ascii 260=(izquierda)</span>
		<span class="cf">if</span>(ch==<span class="dv">27</span>){ outb(<span class="dv">0</span>,puerto); <span class="cf">break</span>;}
    }


    <span class="co">//finalizamos ncurses (regresamos la consola a la normalidad)</span>
    echo();
    resetty();
    endwin();

    <span class="cf">return</span> <span class="dv">0</span>;
}</code></pre></div>
<p>He usado la librería <em>ncurses</em> para manejar las pulsaciones de teclado, sin embargo lo precario del código y la falta de investigación sobre la librería me ha obligado a usar un mecanismo de <em>parada</em>, así pues si pulsamos la tecla dirección <em>adelante</em> el auto avanzará y no se detendrá hasta que pulsemos la barra espaciadora, y lo mismo sucederá con el resto de teclas. Quizás solucione este inconveniente usando SDL pero en otro momento será…</p>
<p>Nos ubicamos en el directorio del código y compilamos el código con (asegúrate de obtener el <em>makefile</em> del repositorio en Github):</p>
<pre><code>$ make</code></pre>
<p>Ejecutamos como root:</p>
<pre><code># ./rc</code></pre>
<p>El programa esperará por nuestras pulsaciones en el teclado y sacara los bits pertinentes por el puerto paralelo, accionando nuestro auto RC.</p>
<p>Como vemos en el código lo correcto para finalizar el programa es presionar la tecla <code>Esc</code> para que nuestra terminal vuelva a la normalidad.</p>
<p>Aquí un video de el auto en acción:</p>
<div class="video embed-responsive embed-responsive-16by9">
<iframe src="https://www.youtube.com/embed/mINnOYImaY8" frameborder="0" allowfullscreen>
</iframe>
</div>
        </div>
    </div>
</div>

                    <div class="row">
                        <div class="col-xs-offset-2 col-xs-8">
                            <a id="archive" href="../../archive.html">Read Older Posts</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>


    </body>
</html>
