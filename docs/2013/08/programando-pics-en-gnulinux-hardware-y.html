<!doctype html>
<html lang="en">
    <head>
        <title>Silly Bytes</title>

        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" type="image/png" href="../../img/favicon.png" />

        <link rel="stylesheet" href="../../css/default.css" />
        <link rel="stylesheet" href="../../css/post-list.css" />
        <link rel="stylesheet" href="../../css/post.css" />

        <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../bower_components/highlight/src/styles/solarized-light.css" />

        <script src="../../bower_components/jquery/dist/jquery.min.js"></script>
        <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../../bower_components/highlight/src/highlight.pack.js"></script>

        <script> hljs.initHighlightingOnLoad(); </script>

    </head>
    <body>
        <header class="container-fluid">
            <div class="row">
                <div class="col-xs-12">
                    <a href="../../">
                        <img alt="Silly Bytes" id="logo" class="image-responsive" src="../../img/silly-bytes_logo.png" />
                    </a>
                </div>
            </div>
        </header>

        <div id="blog" class="container-fluid">
            <div class="row">

                <div id="sidebar" class="hidden-xs hidden-sm col-md-3">
                    <div id="author">
    <img id="author-pic" src="../../img/daniel.jpg">
    <h3 id="author-name">Daniel Campoverde [alx741]</h3>
    <img id="location-icon" src="../../img/location_icon.png">
    <span id="location">Cuenca, Ecuador</span>
</div>

<div id="findme">
    <h2 class="sidebar-h2">FIND ME</h2>
    <a target="_blank" href="https://github.com/alx741">
        <img class="icon" src="../../img/github.png">
    </a>
    <a target="_blank" href="https://twitter.com/alx741alx">
        <img class="icon" src="../../img/twitter.png">
    </a>
    <a target="_blank" href="https://www.facebook.com/sillybytes/">
        <img class="icon" src="../../img/facebook.png">
    </a>
    <a target="_blank" href="https://plus.google.com/116038619580828681039">
        <img class="icon" src="../../img/google.png">
    </a>
    <a target="_blank" href="https://www.joindiaspora.com/u/alx741">
        <img class="icon" src="../../img/diaspora.png">
    </a>

    <div id="findme-textual">
        <b>Freenode:</b> #vim, #archlinux, #avr, #rust, #haskell,
        #yesod, #zsh, #sillybytes
        <hr>
        <b>Mailto:</b> alx@sillybytes.net
        <br>
        <b>GPG Key ID:</b> 12622B78
        <hr>
        <b>Chat</b> with me <a target="_blank" href="http://webchat.freenode.net/?channels=sillybytes">here</a>
    </div>


    <div id="facebook-embed">
        <iframe src="//www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2Fsillybytes&amp;width&amp;height=290&amp;colorscheme=light&amp;show_faces=true&amp;header=true&amp;stream=false&amp;show_border=true" scrolling="yes" style="border:none; overflow:hidden;" allowtransparency="false" frameborder="0"></iframe>
    </div>
</div>


<div id="about">
    <h2 class="sidebar-h2">ABOUT</h2>

    <a target="_blank" href="http://www.haskellers.com/user/4249">
        <img id="haskellers-img" class="badge" alt="I'm a Haskeller" src="../../img/haskellers.png">
    </a>

    <img id="fsf-img" class="badge" alt="Free Software Fundation Member" src="../../img/fsf.png">

    <a target="_blank" href="http://internetdefenseleague.org/">
        <img id="idl-img" class="badge" alt="Internet Defesen League" src="../../img/idl.png">
    </a>
</div>

<div id="dotfiles">
    <h2 class="sidebar-h2">DOTFILES</h2>
    <p>
        Software configuration, scripts, tools and magic.
        Be sure to add <b>attribution </b> when using them
        (fully or partially).
    </p>
    <a target="_blank" href="https://github.com/alx741/dotfiles#readme">
        <img id="dotfiles-img" src="../../img/dotfiles.png">
    </a>
</div>


<div id="license">
    <h2 class="sidebar-h2">LICENSE</h2>

    <a target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
        <img id="cc-img" alt="Creative Commons - SA - BY" src="../../img/cc.png">
    </a>
    <p id="cc-text">
        Silly Bytes by Daniel Alejandro Campoverde Carrión
        [alx741] is licensed under a
        <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
            Creative Commons Attribution-ShareAlike 3.0 Unported License.
        </a>
    </p>
</div>

                </div>

                <div id="content" class="col-xs-12 col-md-9">
                    <div class="row">
    <div class="post col-xs-12">
        <h2 class="post-title">Programando PIC's en GNU/Linux (hardware y software)</h2>
        <div class="post-date-author">
            Posted on August 10, 2013
            
                by Daniel Campoverde
            
        </div>
        <div class="post-content">
            <p><img src="../../img/pic/thumbnail.png" id="thumbnail" /><br />
Mi fuerte es la informática más no la electrónica, pero como se habrá podido apreciar en muchos de mis posts el objetivo de incursionar en un campo aún algo oscuro para mi es el de lograr conectar las capacidades de la informática para reflejar con ello algo en el mundo físico.</p>
<p>Así pues mientras nos metemos de cabeza en la ciencia de la electrónica tarde o temprano usaremos un micro controlador, el cual ya es un eslabón muy intermedio entre estas dos ciencias tan intimas.</p>
<p>La razón es que un micro controlador (uC) es un dispositivo que implementa electrónicamente una maquina de Turing completa, y nos permitirá con sus prestaciones interactuar con circuitos electrónicos mediante algoritmos y programas de software, y es justamente aquí donde viene el problema…</p>
<!--more-->
<p>Una vez hayamos escrito el software y haberlo compilado para ejecutarse en la arquitectura de estos pequeños dispositivos, tenemos que de alguna manera colocar todos esos 0’s y 1’s en la memoria no volátil del micro controlador para que este pueda ejecutarlo.</p>
<p>Para esto usaremos el protocolo ICSP que es especifico de los micro controladores <em>PIC</em> fabricados por la empresa <em>Microchip</em>. Este protocolo nos permitirá comunicarnos de alguna forma desde la computadora con el uC para darle el código del programa que queremos almacene en su memoria.</p>
<p>Para hacerlo necesitamos algo de hardware para conectar la PC y el uC, y el software que implemente debidamente el protocolo ICSP y que nos permita llevar a cabo el cometido.</p>
<p>Así que manos a la obra!</p>
<h1 id="hardware">Hardware</h1>
<p>El protocolo ICSP además de ser un protocolo digital por supuesto, se corresponde con 5 pines del uC que son:</p>
<ul>
<li><code>Vss</code> Masa o <em>GND</em></li>
<li><code>Vdd</code> Alimentación de +5V</li>
<li><code>Vpp</code> Alimentación de +13.2V, pero que en la mayoría de los casos nos bastara con +12V y es precisamente lo que haremos. Se usa para indicarle al uC que empezaremos a comunicarnos con él mediante ICSP</li>
<li><code>Data</code> Señal de datos de entrada y salida, <em>TTL</em></li>
<li><code>Clock</code> Señal de reloj, <em>TTL</em></li>
</ul>
<p>Estos pines los podemos identificar fácilmente en el uC que tengamos buscando su <em>pinout</em>, por ejemplo:</p>
<p>En el PIC18F4550 (Podemos usar cualquier PIC), tenemos su pinout:</p>
<div class="figure">
<img src="../../img/pic/pinout.png" class="img-responsive" />

</div>
<ul>
<li>Pin #1: <code>Vpp</code></li>
<li>Pin #40: <code>PGD</code> (Programming Data)</li>
<li>Pin #39: <code>PGC</code> (programmin Clock)</li>
<li>Pin #11 y #32: <code>VDD</code> (Usamos cualquiera de los 2, en otros PIC’s habrá solamente uno)</li>
<li>pin #12 y #31: <code>VSS</code></li>
</ul>
<p>Ahora que sabemos cuales son los pines correspondientes a ICSP en nuestro PIC, armaremos el hardware que conectará la PC con el uC (PIC). Tendrá 5 cables correspondientes con los pines de ICSP (<em>vpp,vdd,vss,data,clock</em>) y que conectaremos con los pines correspondientes en el uC (PIC) los cuales ya conocemos.</p>
<p>El hardware hace uso del puerto paralelo de la PC, seguramente esto será un impedimento para muchos, pero existe una gran posibilidad de que si andas en estas cosas, tendrás un PC viejito y que tenga puerto paralelo, la ventaja es que el hardware que construiremos es muy barato y simple, por que si quieres uno USB existen muchos tutoriales de como montar uno o incluso puedes comprarlo en cualquier tienda de electrónica (algo caro) y usarlo casi sin mayor problema, pero nosotros estamos aquí para hacerlo de esta manera.</p>
<p>Este es el puerto paralelo, asegúrate de tener una PC que lo tenga antes de continuar.</p>
<div class="figure">
<img src="../../img/pic/shot.jpg" class="img-responsive" />

</div>
<p>Hasta aquí todo perfecto, ahora proporciono el circuito que he obtenido tras mucha prueba y error, así que ya puedo asegurar que este funciona de maravilla!</p>
<div class="figure">
<img src="../../img/pic/scheme1.png" class="img-responsive" />

</div>
<ol style="list-style-type: decimal">
<li>En el diseño los pines en forma de triangulo de color verde etiquetados como <code>PPx</code> (donde <em>x</em> es un numero) corresponden con los pines del puerto paralelo, así el pin <code>PP2</code> se conecta en el pin <em>#2</em> del puerto paralelo, y para saber que pin es ese en el puerto usamos un pinout:</li>
</ol>
<div class="figure">
<img src="../../img/pic/scheme2.png" class="img-responsive" />

</div>
<p>No hace falta que nos preocupemos en los datos que tiene, solamente en los números para saber donde conectar.</p>
<ol start="2" style="list-style-type: decimal">
<li>En el diseño los pines que terminan en un pequeño circulo y que tienen una etiqueta son los cables que irán finalmente a los pines ICSP del uC (PIC) [Vpp,Vdd,Data,Clock] y el pin <code>Vss</code> lo conectamos de cualquiera de aquellos triángulos formados de 3 lineas como aquel que está debajo del pin verde <code>PP25</code>.</li>
</ol>
<p>Listo! Ya lo tenemos, ahora solo resta montar este circuito en un protoboard si lo preferimos y sabemos que cables van al puerto paralelo y que cables a que pines del uC (PIC).</p>
<p>Pero en mi caso he preferido hacer un montaje para poder usarlo siempre y con mayor comodidad (lo recomiendo muchísimo), aquí las instrucciones para hacerlo:</p>
<p>Lo montaremos es una placa pre-perforada</p>
<div class="figure">
<img src="../../img/pic/shot1.jpg" class="img-responsive" />

</div>
<p>Usaremos también un conector “DB25” (Macho) para facilitarnos la conexión al puerto paralelo</p>
<div class="figure">
<img src="../../img/pic/shot2.jpg" class="img-responsive" />

</div>
<p>También algunos conectores para facilitarnos la conexión de alimentación y con los pines ICSP, en este caso tomaremos los +12V y +5V de una fuente de alimentación de PC, así que he tomado el conector de una lectora floppy , pero podemos usar el otro tipo de conector, tomándolo de un viejo HDD o unidad óptica, así podremos conectar fácilmente una fuente de alimentación y tomaremos los +12 del cable de color amarillo y los +5V del cable de color Rojo (GND de los cables negros).</p>
<p>Además use un conector de 5 pines que saque de una vieja impresora, así tendremos cables separados para conectarlos a los pines ICSP del uC (PIC).</p>
<p>Aquí lo apreciamos en el circuito terminado.</p>
<div class="figure">
<img src="../../img/pic/shot3.jpg" class="img-responsive" />

</div>
<p>Con los elementos listados en el diagrama del circuito, los montamos en la placa como si de un protoboard se tratase, pero haciendo las conexiones con estaño (soldandolas)</p>
<div class="figure">
<img src="../../img/pic/shot4.jpg" class="img-responsive" />

</div>
<p>Y obtenemos finalmente el circuito grabador conectado y listo para usarse. Claro que, en cuanto hayamos visto la parte del software (le fuente del PC debe estar encendida y el LED iluminado indicando que el hardware está encendido).</p>
<div class="figure">
<img src="../../img/pic/shot5.jpg" class="img-responsive" />

</div>
<h1 id="software">Software</h1>
<p>Ahora bien, tenemos el hardware construido y debidamente conectado. Necesitamos el software (para sistemas *unix, GNU/Linux en nuestro caso) para interactuar con el uC (PIC) mediante el protocolo ICSP.</p>
<p>Para esto usaremos el software <em>Odyssey</em> que podemos descargar de aquí: <a href="https://github.com/alx741/odyssey">Odyssey</a></p>
<p>Lo instalamos:</p>
<pre><code>$ tar -jxvf odyssey-0.6.tar.bz2 $ cd odyssey-0.6 $ ./configure
$ make
$ sudo make install</code></pre>
<p>Una vez hecho esto tendremos <em>Odyssey</em> instalado en nuestro sistema, así que procedemos a la respectiva configuración.</p>
<p>Necesitamos indicarle a <em>Odyssey</em> que Drivers usar, que puerto usar, que pines del puerto usar, he incluso si la lógica de algún pin está invertida, pero que nadie se preocupe al respecto, solo tendremos que descargar el fichero de configuración que yo he preparado para trabajar con el hardware y ponerlo en el lugar correcto.</p>
<pre><code>[io]
driver=linuxppdev
port=0

[signaldelay]
default=1000

clkpin=3
rdatapin=10
wdatapin=2
vpppin=-6
pwrpin=4  # No usado en este circuito</code></pre>
<p>Lo guardamos en un fichero de nombre <code>odyssey.conf</code>, y lo ubicamos en su lugar con:</p>
<pre><code># mv odyssey.conf /usr/local/etc/</code></pre>
<p>Listo! Tenemos el software instalado y configurado, ahora haremos una prueba que nos ayudará a saber si todo está bien, para esto conectamos todo el hardware debidamente, a excepción del uC (PIC) en lugar de eso dejaremos sueltos los cables que van a los pines ICSP del PIC, con ayuda de un multímetro (configurado como voltímetro) conectaremos (con ayuda de un protoboard de preferencia) el cable negro del multímetro en el cable del pin <code>Vss</code> , y dejaremos libre el cable rojo del multímetro.</p>
<p>En una terminal ejecutamos:</p>
<pre><code>$ odyssey test</code></pre>
<p>Y obtendremos una ventana que esperará nuestras instrucciones y nos indicará que pin esta encendido (1) o apagado (0)</p>
<p>Una vez aquí podremos probar los respectivos pines activándolos con un signo (+) y desactivándolos con un signo (-)</p>
<ul>
<li>Vpp = v</li>
<li>Data = d</li>
<li>Clock = c</li>
</ul>
<p>De esta forma para activar el pin <code>Vpp</code> usamos +v y lo desactivamos usando -v, luego colocamos el cable rojo del multímetro en el pin correspondiente que queremos probar, y este deberá marcarnos 0v (o casi 0V) cuando el pin está apagado y 5V cuando está encendido (excepto para <code>Vpp</code> que deberá marcar unos 12V [un poco más o un poco menos])</p>
<p>Luego de hacer varias pruebas y estar seguros de que todo funciona como lo esperado procedemos a conectar nuestro uC (PIC) en los respectivos pines y ya podremos empezar a hacer cosas con él. Para esto debemos indicarle a <em>Odyssey</em> el PIC que estamos usando, por ejemplo usaremos nuevamente el <em>PIC18F4550</em>:</p>
<p>Para verificar si <em>Odyssey</em> se comunica bien con el PIC, y si el PIC que le indicamos se corresponde con el que hemos colocado:</p>
<pre><code>$ odyssey PIC18F4550 check</code></pre>
<p>Nótese que las letras contenidas en el nombre del PIC son en mayúsculas</p>
<p>Para borrar el programa del PIC:</p>
<pre><code>$ odyssey PIC18F4550 erase</code></pre>
<p>Para verificar si el PIC está en blanco (vacío):</p>
<pre><code>$ odyssey PIC18F4550 blankcheck</code></pre>
<p>Para grabar un programa (programa.hex) [compilado] en el PIC:</p>
<pre><code>$ odyssey PIC18F4550 write programa.hex</code></pre>
<p>Para leer el programa que contiene el PIC:</p>
<pre><code>$ odyssey PIC18F4550 read programa.hex</code></pre>
<p><code>programa.hex</code> es el fichero donde se escribirá el programa que leamos del PIC.</p>
<p>Ya con esto estamos en la capacidad de hacer cualquier cosa que deseemos con un micro controlador PIC, asumiendo que sabemos escribir código en C o Assambly para su arquitectura, pero supongo que si desean saber como grabarlo es por que ya tendrán un programa que grabar en él.</p>
<p>En GNU/Linux podemos escribir el código para el uC en lenguaje C y compilarlo con <em>SDCC</em> (Small Device C Compiler) que podemos instalar de los repositorios de nuestra distribución, el código que compilemos nos generará un fichero <code>programa.hex</code> que será el que grabemos en el uC (PIC)</p>
        </div>
    </div>
</div>

                    <div class="row">
                        <div class="col-xs-offset-2 col-xs-8">
                            <a id="archive" href="../../archive.html">Read Older Posts</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>


        <footer class="container-fluid">
            <div class="row">
                <div id="sidebar" class="visible-xs visible-sm col-xs-12">
                    <div id="author">
    <img id="author-pic" src="../../img/daniel.jpg">
    <h3 id="author-name">Daniel Campoverde [alx741]</h3>
    <img id="location-icon" src="../../img/location_icon.png">
    <span id="location">Cuenca, Ecuador</span>
</div>

<div id="findme">
    <h2 class="sidebar-h2">FIND ME</h2>
    <a target="_blank" href="https://github.com/alx741">
        <img class="icon" src="../../img/github.png">
    </a>
    <a target="_blank" href="https://twitter.com/alx741alx">
        <img class="icon" src="../../img/twitter.png">
    </a>
    <a target="_blank" href="https://www.facebook.com/sillybytes/">
        <img class="icon" src="../../img/facebook.png">
    </a>
    <a target="_blank" href="https://plus.google.com/116038619580828681039">
        <img class="icon" src="../../img/google.png">
    </a>
    <a target="_blank" href="https://www.joindiaspora.com/u/alx741">
        <img class="icon" src="../../img/diaspora.png">
    </a>

    <div id="findme-textual">
        <b>Freenode:</b> #vim, #archlinux, #avr, #rust, #haskell,
        #yesod, #zsh, #sillybytes
        <hr>
        <b>Mailto:</b> alx@sillybytes.net
        <br>
        <b>GPG Key ID:</b> 12622B78
        <hr>
        <b>Chat</b> with me <a target="_blank" href="http://webchat.freenode.net/?channels=sillybytes">here</a>
    </div>


    <div id="facebook-embed">
        <iframe src="//www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2Fsillybytes&amp;width&amp;height=290&amp;colorscheme=light&amp;show_faces=true&amp;header=true&amp;stream=false&amp;show_border=true" scrolling="yes" style="border:none; overflow:hidden;" allowtransparency="false" frameborder="0"></iframe>
    </div>
</div>


<div id="about">
    <h2 class="sidebar-h2">ABOUT</h2>

    <a target="_blank" href="http://www.haskellers.com/user/4249">
        <img id="haskellers-img" class="badge" alt="I'm a Haskeller" src="../../img/haskellers.png">
    </a>

    <img id="fsf-img" class="badge" alt="Free Software Fundation Member" src="../../img/fsf.png">

    <a target="_blank" href="http://internetdefenseleague.org/">
        <img id="idl-img" class="badge" alt="Internet Defesen League" src="../../img/idl.png">
    </a>
</div>

<div id="dotfiles">
    <h2 class="sidebar-h2">DOTFILES</h2>
    <p>
        Software configuration, scripts, tools and magic.
        Be sure to add <b>attribution </b> when using them
        (fully or partially).
    </p>
    <a target="_blank" href="https://github.com/alx741/dotfiles#readme">
        <img id="dotfiles-img" src="../../img/dotfiles.png">
    </a>
</div>


<div id="license">
    <h2 class="sidebar-h2">LICENSE</h2>

    <a target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
        <img id="cc-img" alt="Creative Commons - SA - BY" src="../../img/cc.png">
    </a>
    <p id="cc-text">
        Silly Bytes by Daniel Alejandro Campoverde Carrión
        [alx741] is licensed under a
        <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
            Creative Commons Attribution-ShareAlike 3.0 Unported License.
        </a>
    </p>
</div>

                </div>
            </div>
        </footer>


    </body>
</html>
