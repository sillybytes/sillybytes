<!doctype html>
<html lang="en">
    <head>
        <title>Silly Bytes</title>

        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="../../css/default.css" />
        <link rel="stylesheet" href="../../css/post-list.css" />
        <link rel="stylesheet" href="../../css/post.css" />

        <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../bower_components/highlight/src/styles/solarized-light.css" />

        <script src="../../bower_components/jquery/dist/jquery.min.js"></script>
        <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../../bower_components/highlight/src/highlight.pack.js"></script>

        <script> hljs.initHighlightingOnLoad(); </script>

    </head>
    <body>
        <header class="container-fluid">
            <div class="row">
                <div class="col-xs-12">
                    <a href="../../">
                        <img alt="Silly Bytes" id="logo" class="image-responsive" src="../../img/newcog.png" />
                    </a>
                </div>
            </div>
        </header>

        <div id="blog" class="container-fluid">
            <div class="row">

                <div id="sidebar" class="hidden-xs hidden-sm col-md-3">
                    <div id="author">
                        <img id="author-pic" src="../../img/danie.jpg">
                        <h3 id="author-name">Daniel Campoverde [alx741]</h3>
                        <img id="location-icon" src="../../img/location_icon.png">
                        <span id="location">Cuenca, Ecuador</span>
                    </div>

                    <div id="findme">
                        <h2 class="sidebar-h2">FIND ME</h2>
                        <a target="_blank" href="https://github.com/alx741">
                            <img class="icon" src="../../img/github.png">
                        </a>
                        <a target="_blank" href="https://twitter.com/alx741alx">
                            <img class="icon" src="../../img/twitter.png">
                        </a>
                        <a target="_blank" href="https://www.facebook.com/sillybytes/">
                            <img class="icon" src="../../img/facebook.png">
                        </a>
                        <a target="_blank" href="https://plus.google.com/116038619580828681039">
                            <img class="icon" src="../../img/google.png">
                        </a>
                        <a target="_blank" href="https://www.joindiaspora.com/u/alx741">
                            <img class="icon" src="../../img/diaspora.png">
                        </a>

                        <div id="findme-textual">
                            <b>Freenode:</b> #vim, #archlinux, #avr, #rust, #haskell,
                            #yesod, #zsh, #sillybytes
                            <hr>
                            <b>Mailto:</b> alx@sillybytes.net
                            <br>
                            <b>GPG Key ID:</b> 12622B78
                            <hr>
                            <b>Chat</b> with me <a target="_blank" href="http://webchat.freenode.net/?channels=sillybytes">here</a>
                        </div>


                        <div id="facebook-embed" class="embed-responsive embed-responsive-16by9">
                            <iframe src="//www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2Fsillybytes&amp;width&amp;height=290&amp;colorscheme=light&amp;show_faces=true&amp;header=true&amp;stream=false&amp;show_border=true" scrolling="yes" style="border:none; overflow:hidden; height:290px;" allowtransparency="false" frameborder="0"></iframe>
                        </div>
                    </div>


                    <div id="dotfiles">
                        <h2 class="sidebar-h2">DOTFILES</h2>
                        <p>
                            Software configuration, scripts, tools and magic.
                            Be sure to add <b>attribution </b> when using them
                            (fully or partially).
                        </p>
                        <a target="_blank" href="https://github.com/alx741/dotfiles#readme">
                            <img id="dotfiles-img" src="../../img/dotfiles.png">
                        </a>
                    </div>

                    <div id="about">
                        <h2 class="sidebar-h2">ABOUT</h2>

                        <a target="_blank" href="http://www.haskellers.com/user/4249">
                            <img id="haskellers-img" class="badge" alt="I'm a Haskeller" src="../../img/haskellers.png">
                        </a>

                        <img id="fsf-img" class="badge" alt="Free Software Fundation Member" src="../../img/fsf.png">

                        <a target="_blank" href="http://internetdefenseleague.org/">
                            <img id="idl-img" class="badge" alt="Internet Defesen League" src="../../img/idl.png">
                        </a>
                    </div>


                    <div id="license">
                        <h2 class="sidebar-h2">LICENSE</h2>

                        <a target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
                            <img id="cc-img" alt="Creative Commons - SA - BY" src="../../img/cc.png">
                        </a>
                        <p id="cc-text">
                            Silly Bytes by Daniel Alejandro Campoverde Carrión
                            [alx741] is licensed under a
                            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
                                Creative Commons Attribution-ShareAlike 3.0 Unported License.
                            </a>
                        </p>
                    </div>


                </div>


                <div id="content" class="col-xs-12 col-md-9">
                    <div class="row">
    <div class="post col-xs-12">
        <h2 class="post-title">Fight Flash Fraud (F3), Auto reset hardware</h2>
        <div class="post-date-author">
            Posted on November 11, 2015
            
                by Daniel Campoverde
            
        </div>
        <div class="post-content">
            <p><img src="../../img/f3/thumbnail.png" id="thumbnail" /><br />
<em>F3</em> is an amazing alternative to <em>h2testw</em>, that allows you to test a USB flash drive to find out if it has less capacity than it claims.</p>
<p>There is a LOT of fake USB flash drives on Ebay and other stores; When you use them, they appear to be storing all your data, but when you try to retrieve it, much of it is just lost.</p>
<p><code>f3probe</code> is part of <em>F3</em>, it will test the USB flash drive for you and tell you if it is a fake and how much real memory does it have, but there is a catch: it requires you to physically disconnect and reconnect the drive manually, which slows down the whole process and becomes tedious if you need to probe more than one drive. Here is the solution: a piece of hardware that <code>f3probe</code> will use to automatically connect and reconnect you USB drive without your intervention.</p>
<div class="figure">
<img src="../../img/f3/shot1.jpg" class="img-responsive" />

</div>
<!--more-->
<p>Here is a video about how to use <em>F3</em>:</p>
<div class="video embed-responsive embed-responsive-16by9">
<iframe src="https://www.youtube.com/embed/qnezKfCTO7E" frameborder="0" allowfullscreen>
</iframe>
</div>
<p>And Here you can see the auto reset hardware probing a flash drive:</p>
<div class="video embed-responsive embed-responsive-16by9">
<iframe src="https://www.youtube.com/embed/E0Qq4LPxtxk" frameborder="0" allowfullscreen>
</iframe>
</div>
<p>You can find good documentation about <em>F3</em> <a href="http://oss.digirati.com.br/f3/">here</a> in case you need to know how to use it in more depth.</p>
<h1 id="software">Software</h1>
<p>First you’ll need to use a modified version of <em>F3</em> that you can find in <a href="https://github.com/alx741/f3/tree/autoreset_hw">this branch</a></p>
<p>Download it, compile it and install it with:</p>
<pre><code>$ make
$ make experimental
# make install</code></pre>
<h1 id="hardware">Hardware</h1>
<p>This is the list of materials you’ll need for the project:</p>
<ul>
<li>1 Relay (small)</li>
<li>1 USB A female connector</li>
<li>1 USB B female connector</li>
<li>3 1K resistors</li>
<li>1 2N3904 transistor</li>
<li>1 1N4007 diode</li>
<li>1 3mm green LED</li>
<li>1 5mm yellow LED</li>
<li>1 9V battery</li>
<li>1 9V battery connector</li>
<li>2 electronic pins</li>
<li>2 female to female pin wires</li>
<li>1 Interrupter</li>
<li>1 perforated PCB</li>
<li>1 USB to serial/UART converter</li>
<li>1 USB cables</li>
</ul>
<p>For the USB to serial/UART converter, be sure it has a <strong>DTR</strong> pin.</p>
<div class="figure">
<img src="../../img/f3/shot2.jpg" class="img-responsive" />

</div>
<p>Build the hardware using the following schematic (here is a <a href="https://github.com/alx741/f3/blob/autoreset_hw/hw/schematic.pdf">PDF of it</a>):</p>
<div class="figure">
<img src="../../img/f3/scheme.png" class="img-responsive" />

</div>
<p>Its a good idea to glue the USB connectors to the board so they don’t move when connecting the cables.</p>
<p>Here is how it looks like when ready:</p>
<p><img src="../../img/f3/shot3.jpg" class="img-responsive" /> <img src="../../img/f3/shot4.jpg" class="img-responsive" /> <img src="../../img/f3/shot5.jpg" class="img-responsive" /></p>
<p>The reason I used a battery here is to make it easy to build without the need of a power supply. And yes, I know I could use a voltage booster to use the USB 5v supply, but then over current problems may appear and… Lets just keep the computer safe shall we?</p>
<h1 id="using">Using</h1>
<ul>
<li>Connect the <em>GND</em> and <em>DTR</em> pins of the board with the corresponding ones in the USB-Serial converter like this:</li>
</ul>
<div class="figure">
<img src="../../img/f3/shot6.jpg" class="img-responsive" />

</div>
<ul>
<li>Connect the USB-Serial converter to the computer using an appropriate cable (USB extension in my case).</li>
<li>Connect the board to the computer using a <em>A</em> to <em>B</em> USB cable.</li>
<li>Connect the target USB flash drive to the board.</li>
<li>Turn on the board (the green LED should turn on).</li>
</ul>
<div class="figure">
<img src="../../img/f3/shot7.jpg" class="img-responsive" />

</div>
<p>Then go to your computer and make sure you have the <code>/dev/ttyUSB0</code>, if your USB-Serial converter is on other file, make a symbolic link like this:</p>
<pre><code># ln -s /dev/ttyYOURDEVICE /dev/ttyUSB0</code></pre>
<p>Now you can probe your USB flash drive using the reset-type option with a value of 2:</p>
<pre><code># f3probe --reset-type=2 /dev/TARGET</code></pre>
<p>Replace <code>TARGET</code> with your device, just be sure it’s actually the USB flash drive before hit enter so you don’t mess up your hard drive.</p>
<p>Now the prober board will start blinking the yellow LED and you’ll see in your screen that <code>f3probe</code> reports device resets multiple times. When it’s done it will tell you if your flash drive is a fake or not.</p>
        </div>
    </div>
</div>

                    <div class="row">
                        <div class="col-xs-offset-2 col-xs-8">
                            <a id="archive" href="../../archive.html">Read Older Posts</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>


    </body>
</html>
