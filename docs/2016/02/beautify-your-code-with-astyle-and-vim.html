<!doctype html>
<html lang="en">
    <head>
        <title>Silly Bytes</title>

        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="../../css/default.css" />
        <link rel="stylesheet" href="../../css/post-list.css" />
        <link rel="stylesheet" href="../../css/post.css" />

        <link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../../bower_components/highlight/src/styles/solarized-light.css" />

        <script src="../../bower_components/jquery/dist/jquery.min.js"></script>
        <script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../../bower_components/highlight/src/highlight.pack.js"></script>

        <script> hljs.initHighlightingOnLoad(); </script>

    </head>
    <body>
        <header class="container-fluid">
            <div class="row">
                <div class="col-xs-12">
                    <a href="../../">
                        <img alt="Silly Bytes" id="logo" class="image-responsive" src="../../img/newcog.png" />
                    </a>
                </div>
            </div>
        </header>

        <div id="blog" class="container-fluid">
            <div class="row">

                <div id="sidebar" class="hidden-xs hidden-sm col-md-3">
                    <div id="author">
                        <img id="author-pic" src="../../img/danie.jpg">
                        <h3 id="author-name">Daniel Campoverde [alx741]</h3>
                        <img id="location-icon" src="../../img/location_icon.png">
                        <span id="location">Cuenca, Ecuador</span>
                    </div>

                    <div id="findme">
                        <h2 class="sidebar-h2">FIND ME</h2>
                        <a target="_blank" href="https://github.com/alx741">
                            <img class="icon" src="../../img/github.png">
                        </a>
                        <a target="_blank" href="https://twitter.com/alx741alx">
                            <img class="icon" src="../../img/twitter.png">
                        </a>
                        <a target="_blank" href="https://www.facebook.com/sillybytes/">
                            <img class="icon" src="../../img/facebook.png">
                        </a>
                        <a target="_blank" href="https://plus.google.com/116038619580828681039">
                            <img class="icon" src="../../img/google.png">
                        </a>
                        <a target="_blank" href="https://www.joindiaspora.com/u/alx741">
                            <img class="icon" src="../../img/diaspora.png">
                        </a>

                        <div id="findme-textual">
                            <b>Freenode:</b> #vim, #archlinux, #avr, #rust, #haskell,
                            #yesod, #zsh, #sillybytes
                            <hr>
                            <b>Mailto:</b> alx@sillybytes.net
                            <br>
                            <b>GPG Key ID:</b> 12622B78
                            <hr>
                            <b>Chat</b> with me <a target="_blank" href="http://webchat.freenode.net/?channels=sillybytes">here</a>
                        </div>


                        <div id="facebook-embed" class="embed-responsive embed-responsive-16by9">
                            <iframe src="//www.facebook.com/plugins/likebox.php?href=https%3A%2F%2Fwww.facebook.com%2Fsillybytes&amp;width&amp;height=290&amp;colorscheme=light&amp;show_faces=true&amp;header=true&amp;stream=false&amp;show_border=true" scrolling="yes" style="border:none; overflow:hidden; height:290px;" allowtransparency="false" frameborder="0"></iframe>
                        </div>
                    </div>


                    <div id="dotfiles">
                        <h2 class="sidebar-h2">DOTFILES</h2>
                        <p>
                            Software configuration, scripts, tools and magic.
                            Be sure to add <b>attribution </b> when using them
                            (fully or partially).
                        </p>
                        <a target="_blank" href="https://github.com/alx741/dotfiles#readme">
                            <img id="dotfiles-img" src="../../img/dotfiles.png">
                        </a>
                    </div>

                    <div id="about">
                        <h2 class="sidebar-h2">ABOUT</h2>

                        <a target="_blank" href="http://www.haskellers.com/user/4249">
                            <img id="haskellers-img" class="badge" alt="I'm a Haskeller" src="../../img/haskellers.png">
                        </a>

                        <img id="fsf-img" class="badge" alt="Free Software Fundation Member" src="../../img/fsf.png">

                        <a target="_blank" href="http://internetdefenseleague.org/">
                            <img id="idl-img" class="badge" alt="Internet Defesen League" src="../../img/idl.png">
                        </a>
                    </div>


                    <div id="license">
                        <h2 class="sidebar-h2">LICENSE</h2>

                        <a target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
                            <img id="cc-img" alt="Creative Commons - SA - BY" src="../../img/cc.png">
                        </a>
                        <p id="cc-text">
                            Silly Bytes by Daniel Alejandro Campoverde Carrión
                            [alx741] is licensed under a
                            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
                                Creative Commons Attribution-ShareAlike 3.0 Unported License.
                            </a>
                        </p>
                    </div>


                </div>


                <div id="content" class="col-xs-12 col-md-9">
                    <div class="row">
    <div class="post col-xs-12">
        <h2 class="post-title">Beautify your code with Astyle and Vim</h2>
        <div class="post-date-author">
            Posted on February 26, 2016
            
                by Daniel Campoverde
            
        </div>
        <div class="post-content">
            <p><img src="../../img/astyle/thumbnail.png" id="thumbnail" /><br />
Programmers love good code: good expressivity, good organization, ease of extensibility, maintainability, and so on. But we also like the code to be <strong>pretty</strong>, it makes the work more pleasant and enjoyable, but all this is probably not just for visually appealing reasons.</p>
<p>Is always nice to work with a style consistent code, it even makes it easier to navigate and read, our brains can dissect it more easily and our eyes can quickly jump to the right place. A pretty code transmits the idea that the people who wrote it do actually care about the program.</p>
<p>But there are some mundane reasons too… For lots of us an annoying voice in our heads is constantly telling us “you’re wasting storage space, you’re and idiot!” because some trailing white space or unnecessary blank lines are laying around in the code. Sure, those few extra bytes won’t hurt your 1+TB hard drive!, but for some of us it just feels wrong.</p>
<!--more-->
<h1 id="details">Details</h1>
<p>There is a lot of stuff that you might want to keep neat in your code:</p>
<ul>
<li>Tabs vs Spaces</li>
<li>Maximum characters length</li>
<li>Indent style</li>
<li>Number of spaces per indentation level</li>
<li>Trailing white space</li>
<li>Blank lines the end of the file</li>
<li>Inconsistent number of blink lines between code blocks</li>
<li>Blank space between functions arguments</li>
<li>Space padding around operators</li>
<li>Use and position of brackets</li>
<li>Blank space between various syntactic characters</li>
</ul>
<h1 id="pretty-and-pragmatic">Pretty and pragmatic</h1>
<p>As I told before, consistent style in the code help our brains a lot! But there are actually some extra pragmatic benefits: When using a (good) text editor (like Vim) you may want to use methods for easy moving thought the code, like end-of-line or end-of-file (<code>$</code>, <code>G</code> in Vim), in either case you want to jump to the last character of the line, not to a white space at the end; and you want to jump to the last line of code at the end of the file, not a white and useless line at the end of the file.</p>
<p>A good style consistency can also make some errors pretty obvious using the pattern recognition capabilities of your brain. But, does all that detail really matters? Or is just some mental illness programmers develop over time?</p>
<p>Look… The compiler won’t complain if you leave ugly white space all over the place, the control version system will still keep your code, and your tests will still pass, BUT you and other humans won’t be happy working with a messy heap of characters that nobody cares about, so yeah… It does matters!.</p>
<h1 id="beautify">Beautify</h1>
<p>But if you are here, you probably are already aware of all this, so lets just jump to the useful part.</p>
<p><a href="http://astyle.sourceforge.net/">Artistic Style - Astyle</a> is a fantastic automatic code formatter, so we are going to take advantage of the Unix philosophy here and use it as the external tool to beautify our code while in Vim, along with some other things that <em>Astyle</em> doesn’t handle.</p>
<p>As you might already know, the <code>=</code> Vim command allows you to fix the indentation of the code, so you probably are used to do something like <code>gg=G</code> to fix the entire file.</p>
<p>I prefer not to remap that one as it is useful for visual selection re indentation, so lets use <code>g=</code> to invoke a formatter function. Here it is:</p>
<pre class="vim"><code>function! Format()
    silent! execute 'norm! mz'

    if &amp;ft ==? 'c' || &amp;ft ==? 'cpp' || &amp;ft ==? 'php'
        set formatprg=astyle\ --mode=c
        silent! execute 'norm! gggqG'
    elseif &amp;ft ==? 'java'
        set formatprg=astyle\ --mode=java
        silent! execute 'norm! gggqG'
    endif

    silent! call RemoveTrailingSpaces()
    silent! execute 'retab'
    silent! execute 'gg=G'
    silent! execute 'norm! `z'
    set formatprg=
endfunction</code></pre>
<p>This will invoke <em>Astyle</em> and set the <code>--mode</code> option depending on the current <em>filetype</em>, then remove the trailing spaces, remove blank lines at the end of the file, remove all the tab characters and replace them with proper space indentation, fix the indentation of the whole file and finally leave you where you started. Notice it invokes another custom function <code>RemoveTrailingSpaces()</code>:</p>
<pre class="vim"><code>function! RemoveTrailingSpaces()
    silent! execute '%s/\s\+$//ge'
    silent! execute 'g/\v^$\n*%$/norm! dd'
endfunction</code></pre>
<p>So far, so good, but what is <em>Astyle</em> actually doing with my code?</p>
<p>We want to control with precision how our code is getting the make up applied, so we put our preferences in the <code>~/.astylerc</code> file using all the options listed in the <em>Astyle</em> <a href="http://astyle.sourceforge.net/astyle.html">documentation</a>. Here is mine:</p>
<ul>
<li>–style=allman</li>
<li>–indent=spaces -s4</li>
<li>–indent-classes</li>
<li>–indent-switches</li>
<li>–indent-preproc-define</li>
<li>–indent-col1-comments</li>
<li>–pad-oper</li>
<li>–pad-header</li>
<li>–unpad-paren</li>
<li>–align-pointer=name</li>
<li>–add-brackets</li>
<li>–max-code-length=80</li>
</ul>
<p>The remarkable thing here is the <strong>allman</strong> style I’m using (and recommend) but you can use the one that you prefer: k&amp;r, java, bsd, stroustrup, whitesmith, vtk, gnu, linux, horstmann, and others.</p>
<p>Here you can get my <a href="https://github.com/alx741/dotfiles/blob/master/nvim/.config/nvim/init.vim">.vimrc</a> and my <a href="https://github.com/alx741/dotfiles/blob/master/astyle/.astylerc">.astylerc</a> files.</p>
<p>So you have no excuse now! Trigger that <code>g=</code> to keep you code neat and pretty.</p>
        </div>
    </div>
</div>

                    <div class="row">
                        <div class="col-xs-offset-2 col-xs-8">
                            <a id="archive" href="../../archive.html">Read Older Posts</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>


    </body>
</html>
